<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.bh.admin.mapper.order.OrderShopMapper" >
  <resultMap id="BaseResultMap" type="com.bh.admin.pojo.order.OrderShop" >
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="m_id" property="mId" jdbcType="INTEGER" />
    <result column="shop_id" property="shopId" jdbcType="INTEGER" />
    <result column="order_id" property="orderId" jdbcType="INTEGER" />
    <result column="order_no" property="orderNo" jdbcType="VARCHAR" />
    <result column="shop_order_no" property="shopOrderNo" jdbcType="VARCHAR" />
    <result column="status" property="status" jdbcType="INTEGER" />
    <result column="is_refund" property="isRefund" jdbcType="INTEGER" />
    <result column="delivery_price" property="deliveryPrice" jdbcType="INTEGER" />
    <result column="d_state" property="dState" jdbcType="INTEGER" />
    <result column="is_shop_checkout" property="isShopCheckout" jdbcType="INTEGER" />
    <result column="order_price" property="orderPrice" jdbcType="INTEGER" />
    <result column="g_delivery_price" property="gDeliveryPrice" jdbcType="INTEGER" />
    <result column="receivedtime" property="receivedtime" jdbcType="TIMESTAMP" />
    <result column="cast_time" property="castTime" jdbcType="TIMESTAMP" />
    <result column="send_time" property="sendTime" jdbcType="TIMESTAMP" />
    <result column="jdOrderId" property="jdorderid" jdbcType="VARCHAR" />
    <result column="remark" property="remark" jdbcType="VARCHAR" />
    <result column="err_code" property="errCode" jdbcType="VARCHAR" />
    <result column="err_msg" property="errMsg" jdbcType="VARCHAR" />
    <result column="save_price" property="savePrice" jdbcType="INTEGER" />
    <result column="delivery_way" property="deliveryWay" jdbcType="INTEGER" />
    <result column="print_count" property="printCount" jdbcType="INTEGER" />
    <result column="print_code" property="printCode" jdbcType="VARCHAR" />
    <result column="coupon_id" property="couponId" jdbcType="INTEGER" />
    <result column="coupon_price" property="couponPrice" jdbcType="INTEGER" />
    <result column="print_time" property="printTime" jdbcType="TIMESTAMP" />
    <result column="sku_pay_price" property="skuPayPrice" jdbcType="INTEGER" />
    <result column="is_bean" property="isBean" jdbcType="INTEGER" />
    <result column="valid_len" property="validLen" jdbcType="TIMESTAMP" />
    <result column="express_name" property="expressName" jdbcType="VARCHAR" />
    <result column="express_no" property="expressNo" jdbcType="VARCHAR" />
    <result column="confirm_order" property="confirmOrder" jdbcType="INTEGER" />
     <result column="goods_image" property="goodsImage" jdbcType="VARCHAR" />
     <result column="refund" property="refund" jdbcType="INTEGER" />
     <result column="order_sku_id" property="orderSkuId" jdbcType="INTEGER" />
      <result column="is_refund2" property="isRefund2" jdbcType="INTEGER" />
  </resultMap>
  <sql id="Base_Column_List" >
    id, m_id, shop_id, order_id, order_no, shop_order_no, status, is_refund, delivery_price, 
    d_state, is_shop_checkout, order_price, g_delivery_price, receivedtime, cast_time, 
    send_time, jdOrderId, remark, err_code, err_msg, save_price, delivery_way, print_count, 
    print_code, coupon_id, coupon_price, print_time, sku_pay_price, is_bean, valid_len, 
    express_name, express_no, confirm_order
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    select 
    <include refid="Base_Column_List" />
    from order_shop
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    delete from order_shop
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.bh.admin.pojo.order.OrderShop" useGeneratedKeys="true" keyProperty="id">
    insert into order_shop (id, m_id, shop_id, 
      order_id, order_no, shop_order_no, 
      status, is_refund, delivery_price, 
      d_state, is_shop_checkout, order_price, 
      g_delivery_price, receivedtime, cast_time, 
      send_time, jdOrderId, remark, 
      err_code, err_msg, save_price, 
      delivery_way, print_count, print_code, 
      coupon_id, coupon_price, print_time, 
      sku_pay_price, is_bean, valid_len, 
      express_name, express_no, confirm_order
      )
    values (#{id,jdbcType=INTEGER}, #{mId,jdbcType=INTEGER}, #{shopId,jdbcType=INTEGER}, 
      #{orderId,jdbcType=INTEGER}, #{orderNo,jdbcType=VARCHAR}, #{shopOrderNo,jdbcType=VARCHAR}, 
      #{status,jdbcType=INTEGER}, #{isRefund,jdbcType=INTEGER}, #{deliveryPrice,jdbcType=INTEGER}, 
      #{dState,jdbcType=INTEGER}, #{isShopCheckout,jdbcType=INTEGER}, #{orderPrice,jdbcType=INTEGER}, 
      #{gDeliveryPrice,jdbcType=INTEGER}, #{receivedtime,jdbcType=TIMESTAMP}, #{castTime,jdbcType=TIMESTAMP}, 
      #{sendTime,jdbcType=TIMESTAMP}, #{jdorderid,jdbcType=VARCHAR}, #{remark,jdbcType=VARCHAR}, 
      #{errCode,jdbcType=VARCHAR}, #{errMsg,jdbcType=VARCHAR}, #{savePrice,jdbcType=INTEGER}, 
      #{deliveryWay,jdbcType=INTEGER}, #{printCount,jdbcType=INTEGER}, #{printCode,jdbcType=VARCHAR}, 
      #{couponId,jdbcType=INTEGER}, #{couponPrice,jdbcType=INTEGER}, #{printTime,jdbcType=TIMESTAMP}, 
      #{skuPayPrice,jdbcType=INTEGER}, #{isBean,jdbcType=INTEGER}, #{validLen,jdbcType=TIMESTAMP}, 
      #{expressName,jdbcType=VARCHAR}, #{expressNo,jdbcType=VARCHAR}, #{confirmOrder,jdbcType=INTEGER}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.bh.admin.pojo.order.OrderShop" useGeneratedKeys="true" keyProperty="id">
    insert into order_shop
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="mId != null" >
        m_id,
      </if>
      <if test="shopId != null" >
        shop_id,
      </if>
      <if test="orderId != null" >
        order_id,
      </if>
      <if test="orderNo != null" >
        order_no,
      </if>
      <if test="shopOrderNo != null" >
        shop_order_no,
      </if>
      <if test="status != null" >
        status,
      </if>
      <if test="isRefund != null" >
        is_refund,
      </if>
      <if test="deliveryPrice != null" >
        delivery_price,
      </if>
      <if test="dState != null" >
        d_state,
      </if>
      <if test="isShopCheckout != null" >
        is_shop_checkout,
      </if>
      <if test="orderPrice != null" >
        order_price,
      </if>
      <if test="gDeliveryPrice != null" >
        g_delivery_price,
      </if>
      <if test="receivedtime != null" >
        receivedtime,
      </if>
      <if test="castTime != null" >
        cast_time,
      </if>
      <if test="sendTime != null" >
        send_time,
      </if>
      <if test="jdorderid != null" >
        jdOrderId,
      </if>
      <if test="remark != null" >
        remark,
      </if>
      <if test="errCode != null" >
        err_code,
      </if>
      <if test="errMsg != null" >
        err_msg,
      </if>
      <if test="savePrice != null" >
        save_price,
      </if>
      <if test="deliveryWay != null" >
        delivery_way,
      </if>
      <if test="printCount != null" >
        print_count,
      </if>
      <if test="printCode != null" >
        print_code,
      </if>
      <if test="couponId != null" >
        coupon_id,
      </if>
      <if test="couponPrice != null" >
        coupon_price,
      </if>
      <if test="printTime != null" >
        print_time,
      </if>
      <if test="skuPayPrice != null" >
        sku_pay_price,
      </if>
      <if test="isBean != null" >
        is_bean,
      </if>
      <if test="validLen != null" >
        valid_len,
      </if>
      <if test="expressName != null" >
        express_name,
      </if>
      <if test="expressNo != null" >
        express_no,
      </if>
      <if test="confirmOrder != null" >
        confirm_order,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="mId != null" >
        #{mId,jdbcType=INTEGER},
      </if>
      <if test="shopId != null" >
        #{shopId,jdbcType=INTEGER},
      </if>
      <if test="orderId != null" >
        #{orderId,jdbcType=INTEGER},
      </if>
      <if test="orderNo != null" >
        #{orderNo,jdbcType=VARCHAR},
      </if>
      <if test="shopOrderNo != null" >
        #{shopOrderNo,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        #{status,jdbcType=INTEGER},
      </if>
      <if test="isRefund != null" >
        #{isRefund,jdbcType=INTEGER},
      </if>
      <if test="deliveryPrice != null" >
        #{deliveryPrice,jdbcType=INTEGER},
      </if>
      <if test="dState != null" >
        #{dState,jdbcType=INTEGER},
      </if>
      <if test="isShopCheckout != null" >
        #{isShopCheckout,jdbcType=INTEGER},
      </if>
      <if test="orderPrice != null" >
        #{orderPrice,jdbcType=INTEGER},
      </if>
      <if test="gDeliveryPrice != null" >
        #{gDeliveryPrice,jdbcType=INTEGER},
      </if>
      <if test="receivedtime != null" >
        #{receivedtime,jdbcType=TIMESTAMP},
      </if>
      <if test="castTime != null" >
        #{castTime,jdbcType=TIMESTAMP},
      </if>
      <if test="sendTime != null" >
        #{sendTime,jdbcType=TIMESTAMP},
      </if>
      <if test="jdorderid != null" >
        #{jdorderid,jdbcType=VARCHAR},
      </if>
      <if test="remark != null" >
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="errCode != null" >
        #{errCode,jdbcType=VARCHAR},
      </if>
      <if test="errMsg != null" >
        #{errMsg,jdbcType=VARCHAR},
      </if>
      <if test="savePrice != null" >
        #{savePrice,jdbcType=INTEGER},
      </if>
      <if test="deliveryWay != null" >
        #{deliveryWay,jdbcType=INTEGER},
      </if>
      <if test="printCount != null" >
        #{printCount,jdbcType=INTEGER},
      </if>
      <if test="printCode != null" >
        #{printCode,jdbcType=VARCHAR},
      </if>
      <if test="couponId != null" >
        #{couponId,jdbcType=INTEGER},
      </if>
      <if test="couponPrice != null" >
        #{couponPrice,jdbcType=INTEGER},
      </if>
      <if test="printTime != null" >
        #{printTime,jdbcType=TIMESTAMP},
      </if>
      <if test="skuPayPrice != null" >
        #{skuPayPrice,jdbcType=INTEGER},
      </if>
      <if test="isBean != null" >
        #{isBean,jdbcType=INTEGER},
      </if>
      <if test="validLen != null" >
        #{validLen,jdbcType=TIMESTAMP},
      </if>
      <if test="expressName != null" >
        #{expressName,jdbcType=VARCHAR},
      </if>
      <if test="expressNo != null" >
        #{expressNo,jdbcType=VARCHAR},
      </if>
      <if test="confirmOrder != null" >
        #{confirmOrder,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.bh.admin.pojo.order.OrderShop" >
    update order_shop
    <set >
      <if test="mId != null" >
        m_id = #{mId,jdbcType=INTEGER},
      </if>
      <if test="shopId != null" >
        shop_id = #{shopId,jdbcType=INTEGER},
      </if>
      <if test="orderId != null" >
        order_id = #{orderId,jdbcType=INTEGER},
      </if>
      <if test="orderNo != null" >
        order_no = #{orderNo,jdbcType=VARCHAR},
      </if>
      <if test="shopOrderNo != null" >
        shop_order_no = #{shopOrderNo,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        status = #{status,jdbcType=INTEGER},
      </if>
      <if test="isRefund != null" >
        is_refund = #{isRefund,jdbcType=INTEGER},
      </if>
      <if test="deliveryPrice != null" >
        delivery_price = #{deliveryPrice,jdbcType=INTEGER},
      </if>
      <if test="dState != null" >
        d_state = #{dState,jdbcType=INTEGER},
      </if>
      <if test="isShopCheckout != null" >
        is_shop_checkout = #{isShopCheckout,jdbcType=INTEGER},
      </if>
      <if test="orderPrice != null" >
        order_price = #{orderPrice,jdbcType=INTEGER},
      </if>
      <if test="gDeliveryPrice != null" >
        g_delivery_price = #{gDeliveryPrice,jdbcType=INTEGER},
      </if>
      <if test="receivedtime != null" >
        receivedtime = #{receivedtime,jdbcType=TIMESTAMP},
      </if>
      <if test="castTime != null" >
        cast_time = #{castTime,jdbcType=TIMESTAMP},
      </if>
      <if test="sendTime != null" >
        send_time = #{sendTime,jdbcType=TIMESTAMP},
      </if>
      <if test="jdorderid != null" >
        jdOrderId = #{jdorderid,jdbcType=VARCHAR},
      </if>
      <if test="remark != null" >
        remark = #{remark,jdbcType=VARCHAR},
      </if>
      <if test="errCode != null" >
        err_code = #{errCode,jdbcType=VARCHAR},
      </if>
      <if test="errMsg != null" >
        err_msg = #{errMsg,jdbcType=VARCHAR},
      </if>
      <if test="savePrice != null" >
        save_price = #{savePrice,jdbcType=INTEGER},
      </if>
      <if test="deliveryWay != null" >
        delivery_way = #{deliveryWay,jdbcType=INTEGER},
      </if>
      <if test="printCount != null" >
        print_count = #{printCount,jdbcType=INTEGER},
      </if>
      <if test="printCode != null" >
        print_code = #{printCode,jdbcType=VARCHAR},
      </if>
      <if test="couponId != null" >
        coupon_id = #{couponId,jdbcType=INTEGER},
      </if>
      <if test="couponPrice != null" >
        coupon_price = #{couponPrice,jdbcType=INTEGER},
      </if>
      <if test="printTime != null" >
        print_time = #{printTime,jdbcType=TIMESTAMP},
      </if>
      <if test="skuPayPrice != null" >
        sku_pay_price = #{skuPayPrice,jdbcType=INTEGER},
      </if>
      <if test="isBean != null" >
        is_bean = #{isBean,jdbcType=INTEGER},
      </if>
      <if test="validLen != null" >
        valid_len = #{validLen,jdbcType=TIMESTAMP},
      </if>
      <if test="expressName != null" >
        express_name = #{expressName,jdbcType=VARCHAR},
      </if>
      <if test="expressNo != null" >
        express_no = #{expressNo,jdbcType=VARCHAR},
      </if>
      <if test="confirmOrder != null" >
        confirm_order = #{confirmOrder,jdbcType=INTEGER},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.bh.admin.pojo.order.OrderShop" >
    update order_shop
    set m_id = #{mId,jdbcType=INTEGER},
      shop_id = #{shopId,jdbcType=INTEGER},
      order_id = #{orderId,jdbcType=INTEGER},
      order_no = #{orderNo,jdbcType=VARCHAR},
      shop_order_no = #{shopOrderNo,jdbcType=VARCHAR},
      status = #{status,jdbcType=INTEGER},
      is_refund = #{isRefund,jdbcType=INTEGER},
      delivery_price = #{deliveryPrice,jdbcType=INTEGER},
      d_state = #{dState,jdbcType=INTEGER},
      is_shop_checkout = #{isShopCheckout,jdbcType=INTEGER},
      order_price = #{orderPrice,jdbcType=INTEGER},
      g_delivery_price = #{gDeliveryPrice,jdbcType=INTEGER},
      receivedtime = #{receivedtime,jdbcType=TIMESTAMP},
      cast_time = #{castTime,jdbcType=TIMESTAMP},
      send_time = #{sendTime,jdbcType=TIMESTAMP},
      jdOrderId = #{jdorderid,jdbcType=VARCHAR},
      remark = #{remark,jdbcType=VARCHAR},
      err_code = #{errCode,jdbcType=VARCHAR},
      err_msg = #{errMsg,jdbcType=VARCHAR},
      save_price = #{savePrice,jdbcType=INTEGER},
      delivery_way = #{deliveryWay,jdbcType=INTEGER},
      print_count = #{printCount,jdbcType=INTEGER},
      print_code = #{printCode,jdbcType=VARCHAR},
      coupon_id = #{couponId,jdbcType=INTEGER},
      coupon_price = #{couponPrice,jdbcType=INTEGER},
      print_time = #{printTime,jdbcType=TIMESTAMP},
      sku_pay_price = #{skuPayPrice,jdbcType=INTEGER},
      is_bean = #{isBean,jdbcType=INTEGER},
      valid_len = #{validLen,jdbcType=TIMESTAMP},
      express_name = #{expressName,jdbcType=VARCHAR},
      express_no = #{expressNo,jdbcType=VARCHAR},
      confirm_order = #{confirmOrder,jdbcType=INTEGER}
    where id = #{id,jdbcType=INTEGER}
  </update>

  
  
  
  
  
  <select id="mOrderAccount" parameterType="com.bh.admin.pojo.order.OrderShop" resultType="java.lang.Integer">
    	select count(*) from order_main om ,order_shop os,order_sku osku  where  os.order_id=om.id AND os.id=osku.order_shop_id 
  <if test="shopId !='0'.toString()">
    		and os.shop_id = #{shopId}
  </if>
    <choose>
    	<when test="status==1">
    		and os.status = 1 and os.is_refund !=2
    		 and osku.refund=0
    	</when>
    	<when test="status==2">
    		and (os.status = 2 or os.status = 9) and os.is_refund !=2
    		 and osku.refund=0 
    	</when>
    	<when test="status==3">
    		and (os.status = 3 or os.status = 5)
    		 and osku.refund=0 and os.is_refund !=2
    	</when>
    	<when test="status==4">
    		and os.status = 7
    		and os.is_refund !=2 and os.is_refund =0
    	</when>
    	<when test="status==5">
    		and (os.status = 6 or os.status = 8) 
    	</when>
    	<when test="status==-1">
    		and os.is_refund > 0 and (os.status != 6 or os.status != 8) and osku.refund!=0
    	</when>
    </choose>
   </select>
   
   <select id="mOrderListPage" resultMap="BaseResultMap" parameterType="com.bh.admin.pojo.order.OrderShop" >
   select os.*,osku.sku_image as goodsImage,om.addtime,osku.refund as refund,osku.id as order_sku_id,osku.is_refund as is_refund2
    from order_main om ,order_shop os,order_sku osku  where  os.order_id=om.id AND os.id=osku.order_shop_id
    <if test="shopId!='0'.toString()">
    	and os.shop_id = #{shopId}
    </if>
      <choose>
    	<when test="status==1">
    		and os.status = 1 and os.is_refund !=2
    		 and osku.refund=0
    	</when>
    	<when test="status==2">
    		and (os.status = 2 or os.status = 9)  and os.is_refund !=2
    		 and osku.refund=0 
    	</when>
    	<when test="status==3">
    		and (os.status = 3 or os.status = 5)
    		 and osku.refund=0 and os.is_refund !=2
    	</when>
    	<when test="status==4">
    		and os.status = 7
    		and os.is_refund !=2 and os.is_refund =0
    	</when>
    	<when test="status==5">
    		and (os.status = 6 or os.status = 8) 
    	</when>
    	<when test="status==-1">
    		and os.is_refund > 0 and (os.status != 6 or os.status != 8) and osku.refund!=0
    	</when>
    </choose>
    order by om.addtime desc
  </select>
  
  <select id="mAccount" parameterType="com.bh.admin.pojo.order.OrderShop" resultType="java.lang.Integer">
    select count(*) from order_main om ,order_shop os,order_sku osku  where  os.order_id=om.id AND os.id=osku.order_shop_id
    	and os.shop_id = #{shopId}
    <choose>
    	<when test="status==4">
    		and os.status = 7
    		and os.is_refund !=2 and os.is_refund =0
    	</when>
    	<when test="status==5">
    		and (os.status = 6 or os.status = 8) 
    	</when>
    </choose>
   </select>
   
  <select id="getByOrderIdAndShopId" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    select 
    <include refid="Base_Column_List" />
    from order_shop
    where order_id = #{0} and shop_id = #{1}
  </select>
  
  <select id="getByOrderIdAndStatus" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    select 
    <include refid="Base_Column_List" />
    from order_shop
    where order_id = #{orderId,jdbcType=INTEGER} and status = 2 and d_state = 0
  </select>
  
  <select id="getByOrderId" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    select 
    <include refid="Base_Column_List" />
    from order_shop
    where order_id = #{orderId,jdbcType=INTEGER}
  </select>
  
   <select id="getByShopId" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    select os.*
    from order_shop os left join order_main om on os.order_id=om.id
    where 1=1
    <if test="shopId !='0'.toString()">
    	and os.shop_id = #{shopId}
    </if>
    <if test="status != null and status!='' " >
        and os.status = #{status,jdbcType=INTEGER}
    </if>
    order by om.addtime desc
  </select>
  
  
   <select id="mgetByShopId" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    select os.*
    from order_shop os left join order_main om on os.order_id=om.id
    where  1=1
    <if test="shopId !='0'.toString()">
    	and os.shop_id = #{shopId}
    </if>
    order by om.addtime desc
  </select>
  
  
    <select id="getAlreadyByShopId" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    select 
    <include refid="Base_Column_List" />
    from order_shop
    where status != 1 and status != 6
    <if test="shopId!='0'.toString()">
     and shop_id = #{shopId}
    </if>
   </select>
  
  <select id="getAlreadyByShopIdByTime" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    select a.* from order_shop a LEFT JOIN order_main b on a.order_id = b.id
    where a.status != 1 and a.status != 6 and a.status != 8
    <![CDATA[ and b.addtime >=]]>#{0}
    <![CDATA[ and b.addtime <=]]>#{1}
    <if test="shopId!='0'.toString()">
    	and a.shop_id = #{shopId}
    </if>
  </select>
  
  <select id="orderShopAllList" resultMap="BaseResultMap" parameterType="com.bh.admin.pojo.order.OrderShop" >
    select a.* from order_shop a LEFT JOIN order_main b on a.order_id = b.id
    where a.shop_id = #{0} and a.shop_order_no like CONCAT(CONCAT('%', #{1}), '%')
    <if test="isJd=='0'.toString()">
       and a.jdOrderId = 0
    </if>
    <if test="isJd=='1'.toString()">
       and a.jdOrderId != 0
    </if>
    <![CDATA[ and b.addtime >=]]>#{2}
    <![CDATA[ and b.addtime <=]]>#{3}
    order by b.addtime desc  
  </select>
  
  <select id="orderShopList" resultMap="BaseResultMap" parameterType="com.bh.admin.pojo.order.OrderShop" >
  	select a.* from order_shop a LEFT JOIN order_main b on a.order_id = b.id
  	where a.shop_order_no like CONCAT(CONCAT('%', #{2}), '%')
  	<if test="shopId !='1'.toString()">
  		and a.shop_id = #{shopId}
  	</if>
  	<if test="status != null and status!= ''">
       and a.status = #{status,jdbcType=INTEGER}
    </if>
    <if test="isJd=='0'.toString()">
       and a.jdOrderId = 0
    </if>
    <if test="isJd=='1'.toString()">
       and a.jdOrderId != 0
    </if>
    <![CDATA[ and b.addtime >=]]>#{3}
    <![CDATA[ and b.addtime <]]>#{4}
    order by b.addtime desc  
  </select>
  
  <select id="getOrderByDstate" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    select 
    <include refid="Base_Column_List" />
    from order_shop
    where d_state = #{dState,jdbcType=INTEGER} and status = 2 and is_refund = 0
  </select>
  
  <select id="getDeliveryPriceTypeOrder" parameterType="com.bh.admin.pojo.order.OrderShop" resultMap="BaseResultMap">
      select a.*
      from order_shop a LEFT JOIN member_shop b on a.shop_id = b.m_id
         where a.id in
         <foreach item="id" collection="list" open="(" close=")" separator=",">
             #{id}
         </foreach>
       	 <choose>
       	 	<when test="fz==2">
       	 		order by ACOS(SIN((#{3} * 3.1415) / 180 ) * SIN((b.lat * 3.1415) / 180 )+
				COS((#{3} * 3.1415) / 180 ) * COS((b.lat * 3.1415) / 180 )*COS((#{2} * 3.1415) / 180 - (b.lon * 3.1415) / 180 ) )  * 6380 
				asc
       	 	</when>
       	 	<when test="fz==3">
       	 		order by ACOS(SIN((#{3} * 3.1415) / 180 ) * SIN((b.lat * 3.1415) / 180 )+
				COS((#{3} * 3.1415) / 180 ) * COS((b.lat * 3.1415) / 180 )*COS((#{2} * 3.1415) / 180 - (b.lon * 3.1415) / 180 ) )  * 6380 
				desc
       	 	</when>
       	 	<when test="fz==4">
       	 		order by a.delivery_price desc
       	 	</when>
       	 	<when test="fz==5">
       	 		order by a.delivery_price asc
       	 	</when>
       	 	<otherwise>
       	 		order by a.cast_time asc
       	 	</otherwise>
       	 </choose>
   </select>
  
  
  <select id="sendAccount" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    select a.*
    from order_shop a left join order_send_info b on a.id = b.order_shop_id 
    where b.s_id = #{0} and b.d_state = #{1}
  </select>
  
  
  <!-- <select id="backGroundOrderList" resultMap="BaseResultMap" parameterType="java.util.Map" >
    select a.* 
    from order_shop a LEFT JOIN order_main b ON a.order_id = b.id LEFT JOIN order_sku c ON a.id = c.order_shop_id LEFT JOIN member d ON a.m_id = d.id
    LEFT JOIN order_team e ON a.order_no = e.order_no
    where 1=1
    <if test="shopId !='0'.toString()">
    	and a.shop_id = #{shopId}
    </if>
    <if test="status != null and status !='' ">
    	and a.status = #{status}
    	and a.is_refund =0
    </if>
    <if test="orderNo != null and orderNo != '' ">
    	and a.order_no in 
    	 <foreach item="orderNoList" collection="orderNoList" open="(" close=")" separator=",">
             #{orderNoList}
         </foreach>
    </if>
    <if test="shopOrderNo != null and shopOrderNo != '' ">
    	and a.shop_order_no in 
		 <foreach item="orderShopNoList" collection="orderShopNoList" open="(" close=")" separator=",">
             #{orderShopNoList}
         </foreach>
    </if>
    <if test="startTime != null" >
       and  b.addtime <![CDATA[>=]]> #{startTime}
    </if>
    <if test="endTime != null" >
       and  b.addtime <![CDATA[<=]]> #{endTime}
    </if>
    <if test="id != null">
    	and d.id = #{id}
    </if>
    <if test="tel != null and tel !=''">
    	and d.phone like CONCAT(CONCAT('%', #{tel}), '%')
    </if>
    <if test="fullName != null and fullName!=''">
    	and d.username like CONCAT(CONCAT('%', #{fullName}), '%')
    </if>
    <if test="goodsName != null and goodsName!=''">
    	and c.goods_name like CONCAT(CONCAT('%', #{goodsName}), '%')
    </if>
    order by b.addtime desc, e.team_no desc
  </select> -->
  
  
  <select id="backGroundOrderList" resultMap="BaseResultMap" parameterType="java.util.Map" >
    SELECT
		t.*
	FROM
	(
		SELECT
			a.*,
			b.addtime
		FROM
			order_shop a
		LEFT JOIN order_main b ON a.order_id = b.id
		LEFT JOIN order_sku c ON a.id = c.order_shop_id
		LEFT JOIN member d ON a.m_id = d.id
		where 1=1
		<if test="shopId !='0'.toString()">
    		and a.shop_id = #{shopId}
    	</if>
    	<if test="status != null and status !='' ">
    		<choose>
    			<when test="status==2">
    				and a.status = #{status}
    				and a.is_refund =0
    				and a.order_no not in 
    				(select order_no from order_team where status !=1)
    			</when>
    			<otherwise>
    				and a.status = #{status}
    				and a.is_refund =0
    			</otherwise>
    		</choose>
	    </if>
	    <if test="orderNo != null and orderNo != '' ">
	    	and a.order_no in 
	    	 <foreach item="orderNoList" collection="orderNoList" open="(" close=")" separator=",">
	             #{orderNoList}
	         </foreach>
	    </if>
	    <if test="shopOrderNo != null and shopOrderNo != '' ">
	    	and a.shop_order_no in 
			 <foreach item="orderShopNoList" collection="orderShopNoList" open="(" close=")" separator=",">
	             #{orderShopNoList}
	         </foreach>
	    </if>
	    <if test="startTime != null" >
	       and  b.addtime <![CDATA[>=]]> #{startTime}
	    </if>
	    <if test="endTime != null" >
	       and  b.addtime <![CDATA[<=]]> #{endTime}
	    </if>
	    <if test="id != null">
	    	and d.id = #{id}
	    </if>
	    <if test="tel != null and tel !=''">
	    	and d.phone like CONCAT(CONCAT('%', #{tel}), '%')
	    </if>
	    <if test="fullName != null and fullName!=''">
	    	and d.username like CONCAT(CONCAT('%', #{fullName}), '%')
	    </if>
	    <if test="goodsName != null and goodsName!=''">
	    	and c.goods_name like CONCAT(CONCAT('%', #{goodsName}), '%')
	    </if>
	) t
	ORDER BY
	t.addtime DESC
  </select>
  
  
   <select id="bgJdOrderList" resultMap="BaseResultMap" parameterType="java.util.Map" >
    select a.* 
    from order_shop a LEFT JOIN order_main b ON a.order_id = b.id LEFT JOIN order_sku c ON a.id = c.order_shop_id LEFT JOIN member d ON a.m_id = d.id
    where 1=1 and a.jdOrderId !='0'
    <if test="shopId !='1'.toString()">
    	and a.shop_id = #{shopId}
    </if>
    <if test="status != null">
    	and a.status = #{status}
    	and a.is_refund =0
    </if>
    <if test="orderNo != null and orderNo != '' ">
    	and a.order_no in 
    	 <foreach item="orderNoList" collection="orderNoList" open="(" close=")" separator=",">
             #{orderNoList}
         </foreach>
    </if>
    <if test="shopOrderNo != null and shopOrderNo != '' ">
    	and a.shop_order_no in 
		 <foreach item="orderShopNoList" collection="orderShopNoList" open="(" close=")" separator=",">
             #{orderShopNoList}
         </foreach>
    </if>
    <if test="startTime != null" >
       and  b.addtime <![CDATA[>=]]> #{startTime}
    </if>
    <if test="endTime != null" >
       and  b.addtime <![CDATA[<=]]> #{endTime}
    </if>
    <if test="id != null">
    	and d.id = #{id}
    </if>
    <if test="tel != null and tel !=''">
    	and d.phone like CONCAT(CONCAT('%', #{tel}), '%')
    </if>
    <if test="fullName != null and fullName!=''">
    	and d.username like CONCAT(CONCAT('%', #{fullName}), '%')
    </if>
    <if test="goodsName != null and goodsName!=''">
    	and c.goods_name like CONCAT(CONCAT('%', #{goodsName}), '%')
    </if>
    order by b.addtime desc
  </select>
  
   <select id="jdOrderCount" parameterType="java.lang.Integer" resultType="java.lang.Integer">
    select count(id)
    from order_shop
    where jdOrderId!='0'
    <if test="shopId !='1'.toString()">
    	and shop_id = #{shopId}
    </if>
   </select>
 
  
  <!-- **************************************************************end********************************************************************************* -->
  <!-- 2017-10-26 chengfengyun -->
  <insert id ="insertOrderShopByBatch" useGeneratedKeys="true" keyProperty="id" parameterType="java.util.List">
	 insert into order_shop ( m_id, shop_id, 
      order_id, order_no, shop_order_no
      )
    <foreach collection ="list" index= "index" separator =",">
	( #{mId,jdbcType=INTEGER}, #{shopId,jdbcType=INTEGER}, 
      #{orderId,jdbcType=INTEGER}, #{orderNo,jdbcType=VARCHAR}, #{shopOrderNo,jdbcType=VARCHAR}
      )
      </foreach>
	</insert>
	<!-- 2017-10-27chengfengyun -->
	<!-- 通过查询mId,order_id,orderNo 查询 ordershop表 -->
	<select id="selectOrderShopByOrderIds" parameterType="com.bh.admin.pojo.order.OrderShop" resultMap="BaseResultMap">
      select oshop.* from order_shop oshop,order_main main,order_sku sku
     where 1=1 
        and oshop.order_id=main.id 
        and sku.order_id=main.id
        and sku.order_shop_id=oshop.id

       <if test="mId != null" >
       and oshop.m_id = #{mId,jdbcType=INTEGER}
      </if>
      <if test="shopId != null" >
       and oshop.shop_id = #{shopId,jdbcType=INTEGER}
      </if>
      <if test="orderId != null" >
       and oshop.order_id = #{orderId,jdbcType=INTEGER}
      </if>
      <if test="orderNo != null" >
       and oshop.order_no = #{orderNo,jdbcType=VARCHAR}
      </if>
      <if test="shopOrderNo != null" >
       and oshop.shop_order_no = #{shopOrderNo,jdbcType=VARCHAR}
      </if>
      <if test="status != null" >
       and oshop.status = #{status,jdbcType=INTEGER}
      </if>
      <if test="isRefund != null" >
       and oshop.is_refund = #{isRefund,jdbcType=INTEGER},
      </if>
      order by oshop.order_id desc
	</select>
	
	<select id="selectOrderShopByOrderIds1" parameterType="com.bh.admin.pojo.order.OrderShop" resultMap="BaseResultMap">
     select oshop.* from order_shop oshop,order_main main where 1=1 
         and oshop.order_id=main.id 

       <if test="mId != null" >
       and oshop.m_id = #{mId,jdbcType=INTEGER}
      </if>
      <if test="shopId != null" >
       and oshop.shop_id = #{shopId,jdbcType=INTEGER}
      </if>
      <if test="orderId != null" >
       and oshop.order_id = #{orderId,jdbcType=INTEGER}
      </if>
      <if test="orderNo != null" >
       and oshop.order_no = #{orderNo,jdbcType=VARCHAR}
      </if>
      <if test="shopOrderNo != null" >
       and oshop.shop_order_no = #{shopOrderNo,jdbcType=VARCHAR}
      </if>
      <if test="status != null" >
       and oshop.status = #{status,jdbcType=INTEGER}
      </if>
      <if test="isRefund != null" >
       and oshop.is_refund = #{isRefund,jdbcType=INTEGER},
      </if>
      order by oshop.order_id desc
	</select>
	
	 <!--  *****通过m_id 和group_id 查询 ordershop表 2017-11-2添加and status !=8******* -->
	  <select id="selectOrderShopBySelect" resultMap="BaseResultMap" parameterType="com.bh.admin.pojo.order.OrderShop" >
	    select 
    shop.*
    from order_shop shop,order_main main,order_sku sku ,goods_sku gsku  
         where 1=1 
          and shop.order_id=main.id
          and shop.id=sku.order_shop_id
          and sku.order_id=main.id
          and gsku.id=sku.sku_id
         and shop.status !=8
    <if test="mId != null" >
       and shop.m_id = #{mId,jdbcType=INTEGER}
      </if>
     <if test="status != null" >
       and shop.status = #{status,jdbcType=INTEGER}
      </if>
      <if test="orderNo != null" >
       and (shop.order_no like CONCAT(CONCAT('%', #{orderNo}), '%') or shop.shop_order_no like CONCAT(CONCAT('%', #{orderNo}), '%') or  sku.goods_name like CONCAT(CONCAT('%', #{orderNo}), '%') )
      </if>
      <if test="goodsName != null" >
      and sku.goods_name like CONCAT(CONCAT('%', #{goodsName}), '%')
      </if>
     GROUP BY shop.order_id ORDER BY shop.order_id DESC
  </select>
  	 <!--  *****通过m_id 和group_id 查询 ordershop表 2017-11-2添加and status !=8******* -->
	  <select id="selectOrderShopParams" resultMap="BaseResultMap" parameterType="com.bh.admin.pojo.order.OrderShop" >
    select 
    a.*
    from order_shop a ,order_sku b ,order_main c ,goods_sku gsku 
    where 1=1 
      and a.id = b.order_shop_id
      and c.id=b.order_id
      and a.order_id=c.id
      and b.sku_id=gsku.id
    <if test="mId != null" >
       and a.m_id = #{mId,jdbcType=INTEGER}
      </if>
     <if test="status != null" >
       and (a.status =2 or a.status = 5)
      </if>
      <if test="orderNo != null" >
       and (a.order_no like CONCAT(CONCAT('%', #{orderNo}), '%') or a.shop_order_no like CONCAT(CONCAT('%', #{orderNo}), '%') )
      </if>
      <if test="goodsName != null" >
      and b.goods_name like CONCAT(CONCAT('%', #{goodsName}), '%')
      </if>
      
     GROUP BY a.id ORDER BY c.addtime DESC
  </select>
  
  
  
  
   <select id="selectOrderShopByOrderId" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
      select 
         shop.*
      from 
          order_shop shop ,order_sku sku ,order_main main
      where 1=1 
      and shop.order_id=main.id
      and shop.id=sku.order_shop_id
      and main.id=sku.order_id
     <if test="orderId != null" >
       and shop.order_id = #{orderId,jdbcType=INTEGER}
      </if>
     GROUP BY shop.order_id ORDER BY shop.order_id DESC
  </select>
  
  	<update id="updateOrderShopBySelect" parameterType="com.bh.admin.pojo.order.OrderShop">	
	update order_shop   
	<set>
	<if test="status != null" >
        status = #{status,jdbcType=INTEGER},
      </if>
      <if test="receivedtime != null" >
        receivedtime = #{receivedtime,jdbcType=TIMESTAMP}
      </if>
      </set> 
      where 1=1 
      and id = #{id,jdbcType=INTEGER}
      
	</update>
	 <select id="selectByOrderShopId" resultMap="BaseResultMap" parameterType="com.bh.admin.pojo.order.OrderShop" >
      select 
         shop.*
      from 
         order_shop shop ,order_sku sku ,order_main main
      where 1=1 
      and shop.order_id=main.id
      and shop.id=sku.order_shop_id
      and main.id=sku.order_id
    and shop.id = #{id,jdbcType=INTEGER}
  </select>
	  <select id="selectOrderShopByRefunt" resultMap="BaseResultMap" parameterType="com.bh.admin.pojo.order.OrderShop" >
    select 
    shop.*
    from 
    order_shop shop ,order_sku sku ,order_main main
    where 1=1 
      and shop.order_id=main.id
      and shop.id=sku.order_shop_id
      and main.id=sku.order_id
      and shop.m_id = #{mId,jdbcType=INTEGER} 
    <if test="isRefund != null" >
      and shop.is_refund = #{isRefund,jdbcType=INTEGER}
    </if>
      ORDER BY shop.order_id DESC
  </select>
  <select id="selectOrderShopByOrder" parameterType="com.bh.admin.pojo.order.OrderShop" resultMap="BaseResultMap">
	 select 
          shop.*
    from 
    order_shop shop ,order_sku sku ,order_main main
    where 1=1 
      and shop.order_id=main.id
      and shop.id=sku.order_shop_id
      and main.id=sku.order_id
      <if test="mId != null" >
       and shop.m_id = #{mId,jdbcType=INTEGER}
     </if>
      <if test="shopId != null" >
       and shop.shop_id = #{shopId,jdbcType=INTEGER}
      </if>
      <if test="orderId != null" >
       and shop.order_id = #{orderId,jdbcType=INTEGER}
      </if>
      <if test="orderNo != null" >
       and shop.order_no = #{orderNo,jdbcType=VARCHAR}
      </if>
      <if test="shopOrderNo != null" >
       and shop.shop_order_no = #{shopOrderNo,jdbcType=VARCHAR}
      </if>
      <if test="status != null" >
       and shop.status = #{status,jdbcType=INTEGER}
      </if>
      <if test="isRefund != null" >
       and shop.is_refund = #{isRefund,jdbcType=INTEGER},
      </if>
      order by shop.order_id desc
	</select>
	 <select id="selectOrderShopByOrderNo" parameterType="com.bh.admin.pojo.order.OrderShop" resultMap="BaseResultMap">
  		select shop.*
        from order_shop shop,order_main main,order_sku sku,order_team team
        where  1=1 
		  and shop.m_id=main.m_id
	      and shop.order_id=main.id
          and shop.id=sku.order_shop_id
          and main.id=sku.order_id
		  and main.order_no=team.order_no
		  and team.m_id = #{mId,jdbcType=INTEGER}
		  and team.`status` =0
		  and shop.`status`=2
		  order by team.create_time desc
	</select>
	 <update id="updateOrderShopByParams" parameterType="com.bh.admin.pojo.order.OrderShop" >
    update order_shop
    set 
      <if test="isRefund != null" >
        is_refund = #{isRefund,jdbcType=INTEGER}
      </if>
    where id = #{id,jdbcType=INTEGER}
  </update>
   <update id="updateOrderPrice" parameterType="com.bh.admin.pojo.order.OrderShop" >
    update order_shop
    <set>
      <if test="orderPrice != null" >
        order_price = #{orderPrice,jdbcType=INTEGER},
      </if>
       <if test="savePrice != null" >
        save_price = #{savePrice,jdbcType=INTEGER},
      </if>
      </set>
    where order_id = #{orderId,jdbcType=INTEGER}
  </update>
  	
	 <!--  *****通过用户的id 查询待待发货商品******* -->
	  <select id="selectOrderShopByStatus2" resultMap="BaseResultMap" parameterType="com.bh.admin.pojo.order.OrderShop" >
  select 
    a.*
    from  order_shop a , order_sku b , order_main c 
    
    where 1=1   
    and c.id=a.order_id
    and c.id=b.order_id
    and b.order_shop_id=a.id
    and a.order_no not in (select team.order_no from order_team team where  team.`status` in(-1,0) and team.m_id=#{mId,jdbcType=INTEGER})
     and a.is_refund !=2
    <if test="status ='2'.toString()"> <!-- 备货中的订单也要在待发货中显示 xieyc-->
    and	( a.status in (2,9)  )
    </if>
    <if test="mId != null" >
       and a.m_id = #{mId,jdbcType=INTEGER}
      </if>
      <if test="orderNo != null" >
       and (a.order_no like CONCAT(CONCAT('%', #{orderNo}), '%') or a.shop_order_no like CONCAT(CONCAT('%', #{orderNo}), '%') or  b.goods_name like CONCAT(CONCAT('%', #{orderNo}), '%') )
      </if>
      <if test="goodsName != null" >
      and b.goods_name like CONCAT(CONCAT('%', #{goodsName}), '%')
      </if>
       GROUP BY a.order_id ORDER BY a.order_id DESC
  </select>
  <!-- 查询移动端商家今日的收入 -->
  <select id="selectMShopThisDayInCome" parameterType="java.lang.Integer" resultType="java.lang.Integer">
         select COALESCE(sum(main.order_price),0)  from order_shop shop,order_main main where 1=1 
          and shop.order_id=main.id
          and main.`status` in (2,3)
         and  to_days(main.addtime) = to_days(now()) 
         <if test="shopId !='0'.toString()">
    		 and main.shop_id =  #{shopId,jdbcType=INTEGER} 
    	</if>
         
  </select>
  <!-- 查询移动端商家这个月的收入 -->
  <select id="selectMShopThisMonthInCome" parameterType="java.lang.Integer" resultType="java.lang.Integer">
    select COALESCE(sum(main.order_price),0)  as amountsum from order_shop shop,order_main main where 1=1 
     and shop.order_id=main.id
     and main.`status` in (2,3)
     and DATE_FORMAT(main.addtime,'%Y%m') = DATE_FORMAT(NOW(),'%Y%m')
      <if test="shopId !='0'.toString()">
    		and main.shop_id =  #{shopId,jdbcType=INTEGER}  
      </if>
     
  </select>
  <!-- 跟据商家查询该商家订单下面的待分享的订单 -->
   <select id="selectShareOrderListByShopId" resultMap="BaseResultMap" parameterType="java.util.Map" > 
    SELECT
	t.*
	FROM(
		SELECT
			a.*,
			b.addtime
		FROM
			order_shop a
		LEFT JOIN order_main b ON a.order_id = b.id
		LEFT JOIN order_sku c ON a.id = c.order_shop_id
		LEFT JOIN member d ON a.m_id = d.id
		LEFT JOIN order_team e ON a.order_no = e.order_no
		where 1=1
    	and e.`status`=0
    	and a.`status`=2 
    <if test="shopId !='0'.toString()">
    	and a.shop_id = #{shopId}
    </if>
    and a.is_refund =0
    <if test="orderNo != null and orderNo != '' ">
    	and a.order_no in 
    	 <foreach item="orderNoList" collection="orderNoList" open="(" close=")" separator=",">
             #{orderNoList}
         </foreach>
    </if>
    <if test="shopOrderNo != null and shopOrderNo != '' ">
    	and a.shop_order_no in 
		 <foreach item="orderShopNoList" collection="orderShopNoList" open="(" close=")" separator=",">
             #{orderShopNoList}
         </foreach>
    </if>
    <if test="startTime != null" >
       and  b.addtime <![CDATA[>=]]> #{startTime}
    </if>
    <if test="endTime != null" >
       and  b.addtime <![CDATA[<=]]> #{endTime}
    </if>
    <if test="id != null">
    	and d.id = #{id}
    </if>
    <if test="tel != null and tel !=''">
    	and d.phone like CONCAT(CONCAT('%', #{tel}), '%')
    </if>
    <if test="fullName != null and fullName!=''">
    	and d.username like CONCAT(CONCAT('%', #{fullName}), '%')
    </if>
    <if test="goodsName != null and goodsName!=''">
    	and c.goods_name like CONCAT(CONCAT('%', #{goodsName}), '%')
    </if>
    ORDER BY
		e.team_no DESC
	) t
	ORDER BY
	t.addtime DESC
  </select>
   <select id="selectShareCountByShopId" resultType="java.lang.Integer" parameterType="java.util.Map" >
        SELECT
			COUNT(a.id)
		FROM
			order_shop a
		LEFT JOIN order_main b ON a.order_id = b.id
		LEFT JOIN order_sku c ON a.id = c.order_shop_id
		LEFT JOIN member d ON a.m_id = d.id
		LEFT JOIN order_team e ON a.order_no = e.order_no
		where 1=1
    	and e.`status`=0
    	and a.`status`=2 
    <if test="shopId !='0'.toString()">
    	and a.shop_id = #{shopId}
    </if>
    and a.is_refund =0
  </select>
  
    <select id="selectShareCountByShopIdByTime" resultType="java.lang.Integer" parameterType="java.util.Map" >
        	select count(shop.id)		
	 from 
			order_main main,order_shop shop,order_sku osku,member m,member_user_address md,
			goods_sku gsku,goods g,order_team team 	
	where 1=1
			and main.id=shop.order_id
			and shop.id=osku.order_shop_id
			and main.id=osku.order_id
			and main.m_addr_id=md.id
			and main.m_id=m.id
			and gsku.id=osku.sku_id
			and gsku.goods_id=g.id
			and shop.order_no=team.order_no
    	    and team.`status`=0
    	    and shop.`status`=2 
			and shop.is_refund =0
    	    and team.`status`=0
    	    and shop.`status`=2 
    <if test="shopId !='0'.toString()">
    	and shop.shop_id = #{shopId}
    </if>
  </select>
  
  
	<!-- chengfeng -->
	
	
	
	   <!-- xxj start -->
   <!-- 更新订单状态 -->
   <update id="updateStatusByOrderNo" parameterType="com.bh.admin.pojo.order.OrderShop">
    update order_shop
    <set >
      <if test="status != null" >
        status = #{status,jdbcType=INTEGER},
      </if>
    </set>
    where order_no = #{orderNo}
  </update>
  
    <!-- 进账统计:根据条件查询商家订单列表 xieyc -->
    <select id="getShopOrderList"  resultMap="BaseResultMap">
  	   select os.* from order_shop os inner JOIN  order_main om on os.order_id=om.id where 1=1
  	   <if test="shopId != null " >
        and os.shop_id = #{shopId,jdbcType=INTEGER}
       </if>
       <if test="id != null" >
        and os.id = #{id,jdbcType=INTEGER}
       </if>
       <if test="order_id != null" >
        and os.order_id = #{order_id,jdbcType=INTEGER}
       </if>
      <if test="order_no != null and  order_no !='' " >
        and os.order_no like CONCAT(CONCAT('%', #{order_no}), '%')
      </if>
      <if test="payment_no != null and  payment_no !='' " >
        and om.payment_no like CONCAT(CONCAT('%', #{payment_no}), '%')
      </if>
      <if test="payment_id != null" >
       and om.payment_id =#{payment_id,jdbcType=INTEGER}
      </if>
      <if test="status != null" >
       and os.status = #{status,jdbcType=INTEGER}
      </if>
      order by om.addtime desc
	</select>
  
  
  	<!-- 统计:7日内店铺销售TOP10 xieyc -->
    <select id="getTopTenShopList"  resultMap="BaseResultMap">
  	  select sum(os.order_price)-sum(os.g_delivery_price) amount,os.shop_id from order_shop os inner JOIN  order_main om on os.order_id=om.id 
  	  where  os.status not in(1,6) and om.payment_status!=1
  	  <![CDATA[ and om.addtime >=]]> #{0}
      <![CDATA[ and om.addtime <=]]> #{1}
  	  group by os.shop_id	
      order by amount desc
	</select>
	<!-- 统计:查询商家已付款的订单(状态不为1代付款 6已取消 8已删除(没付款)) xieyc -->
    <select id="getShopOrder"  resultMap="BaseResultMap">
  	   select  os.* from order_shop os  inner JOIN  order_main om on os.order_id=om.id
  	   where os.status not in(1,6)   and om.payment_status!=1
  	   and  os.shop_id =#{shopId,jdbcType=INTEGER}
  	   <![CDATA[ and om.addtime >=]]> #{1}
       <![CDATA[ and om.addtime <=]]> #{2}
	</select>
	
	<!-- zlk 打印专用-->
	<select id="getByOrderNo" resultMap="BaseResultMap" parameterType="com.bh.admin.pojo.order.OrderShop">
       select * from order_shop
       where shop_order_no = #{shopOrderNo,jdbcType=VARCHAR}
      <!--  and jdOrderId in (0,-1) -->
       and shop_id = #{shopId,jdbcType=INTEGER}
    </select>
   
	<select id="getByOrderNos" resultMap="BaseResultMap" parameterType="com.bh.admin.pojo.order.OrderShop">
       select * from order_shop
       where order_no = #{orderNo,jdbcType=VARCHAR}
       and jdOrderId in (0,-1)
       and shop_id = #{shopId,jdbcType=INTEGER}
    </select>
    <!-- end -->
    <select id="mCountorderShopNum" resultType="java.lang.Integer" parameterType="java.lang.Integer">
       select count(*) from order_shop  where shop_id = #{shopId} and status != 1 and status != 6 and status != 8
    </select>
   
    <select id="mgetShopOrder" resultMap="BaseResultMap" parameterType="java.lang.Integer">
       select * from order_shop  where shop_id = #{shopId} and status != 1 and status != 6 and status != 8
    </select>
    
     <select id="mgetShopOrderEveryDay" resultType="java.lang.Double" >
       select  COALESCE(sum(os.order_price),0)  amountEveryDay  from order_shop os left join order_main om
       on os.order_id=om.id
       where 1=1
       <if test="shopId!='0'.toString()">
       and os.shop_id = #{shopId}
       </if> 
       and os.status != 1 and os.status != 6 and os.status !=8
       and  DATE_FORMAT(om.addtime,'%Y-%m-%d') = DATE_FORMAT(#{today},'%Y-%m-%d')
    </select>
    
    <select id="mgetCountDetailList" resultMap="BaseResultMap" parameterType="java.lang.Integer">
       select * from order_shop  os left join order_main om  on os.order_id=om.id
       where 1=1
       <if test="shopId !='0'.toString()">
       	and	os.shop_id = #{shopId}
       </if> 
       and os.status != 1 and os.status != 6 and os.status != 8
       <if test="isRefund == 0" >
           and os.is_refund=0
       </if>
       <if test="isRefund ==1" >
           and os.is_refund !=0
       </if>
       order by om.addtime desc
    </select>
    
    
    
    
     <resultMap id="MyResultMap" type="com.bh.admin.pojo.order.MyOrderShop" >
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="m_id" property="mId" jdbcType="INTEGER" />
    <result column="shop_id" property="shopId" jdbcType="INTEGER" />
    <result column="order_id" property="orderId" jdbcType="INTEGER" />
    <result column="order_no" property="orderNo" jdbcType="VARCHAR" />
    <result column="shop_order_no" property="shopOrderNo" jdbcType="VARCHAR" />
    <result column="status" property="status" jdbcType="INTEGER" />
    <result column="is_refund" property="isRefund" jdbcType="INTEGER" />
    <result column="delivery_price" property="deliveryPrice" jdbcType="INTEGER" />
    <result column="d_state" property="dState" jdbcType="INTEGER" />
    <result column="is_shop_checkout" property="isShopCheckout" jdbcType="INTEGER" />
    <result column="order_price" property="orderPrice" jdbcType="INTEGER" />
    <result column="g_delivery_price" property="gDeliveryPrice" jdbcType="INTEGER" />
    <result column="receivedtime" property="receivedtime" jdbcType="TIMESTAMP" />
    <result column="cast_time" property="castTime" jdbcType="TIMESTAMP" />
    <result column="send_time" property="sendTime" jdbcType="TIMESTAMP" />
    <result column="jdOrderId" property="jdorderid" jdbcType="VARCHAR" />
    <result column="remark" property="remark" jdbcType="VARCHAR" />
    <result column="err_code" property="errCode" jdbcType="VARCHAR" />
    <result column="err_msg" property="errMsg" jdbcType="VARCHAR" />
    <result column="save_price" property="savePrice" jdbcType="INTEGER" />
    <result column="delivery_way" property="deliveryWay" jdbcType="INTEGER" />
    <result column="print_count" property="printCount" jdbcType="INTEGER" />
    <result column="print_code" jdbcType="VARCHAR" property="printCode" />
    
    <result column="all_price" property="allPrice" jdbcType="DOUBLE"  />
    <result column="addtime" property="addtime" jdbcType="TIMESTAMP"  />
    <result column="full_name" property="fullName" jdbcType="VARCHAR"  />
    <result column="tel" property="tel" jdbcType="VARCHAR"  />
    <result column="provname" property="provname" jdbcType="VARCHAR" />
    <result column="cityname" property="cityname" jdbcType="VARCHAR" />
    <result column="areaname" property="areaname" jdbcType="VARCHAR" />
    <result column="fourname" property="fourname" jdbcType="VARCHAR" />
    <result column="address" property="address" jdbcType="VARCHAR" />
    <result column="user_nick" property="userNick" jdbcType="VARCHAR" />
    <result column="phone" property="phone" jdbcType="VARCHAR" />
    <result column="jd_sku_no" property="jdSkuNo" jdbcType="VARCHAR" />
    <result column="jd_pirce" property="jdPirce" jdbcType="DOUBLE"  />
    <result column="jd_protocol_price" property="jdProtocolPrice" jdbcType="DOUBLE"  />
    <result column="price" property="price" jdbcType="DOUBLE"  />
    <result column="value" property="value" jdbcType="VARCHAR" />
     
    <result column="goods_name" property="goodsName" jdbcType="VARCHAR"  />
    <result column="goods_image" property="goodsImage" jdbcType="VARCHAR"  />
    <result column="good_num" property="goodNum" jdbcType="INTEGER"  />
    <result column="team_num" property="teamNum" jdbcType="INTEGER"  />
    <result column="top" property="top" jdbcType="INTEGER"  />
    <result column="order_sku_id" property="orderSkuId" jdbcType="INTEGER"  />
    <result column="is_refund1" property="isRefund1" jdbcType="INTEGER" />
    <result column="d_state" property="dState" jdbcType="INTEGER" />
    </resultMap>
     <select id="MyBackGroundOrderList" resultMap="MyResultMap" parameterType="java.util.Map" >
   	select shop.id,shop.m_id,shop.order_no,shop.shop_order_no,shop.status,
   	        cast(shop.order_price/100 as decimal(20,2)) as all_price,
   	        shop.remark,shop.is_refund,
			main.addtime as addtime,main.fz as top,
			main.express_name as expressName,main.express_no as expressNo,
			osku.goods_name as goods_name,
			osku.sku_image as goods_image,
			cast(osku.sku_sell_price_real/100 as decimal(20,2)) as price,
			osku.sku_num as good_num,
			osku.sku_value as value,
			md.full_name as full_name,
			md.tel as tel,
			md.provname as provname,
			md.cityname as cityname,
			md.areaname as areaname,
			md.fourname as fourname,
			md.address as address,
			m.username as user_nick,
			m.phone as phone,
			gsku.jd_sku_no as jd_sku_no,
			cast(gsku.jd_price/100 as decimal(20,2)) as jd_pirce ,
			cast(gsku.jd_protocol_price/100 as decimal(20,2)) as jd_protocol_price,
			g.team_num as team_num,
			osku.id as order_sku_id	,
			osku.is_refund as is_refund1,shop.d_state as d_state
	 from 
			order_main main,order_shop shop,order_sku osku,member m,member_user_address md,
			goods_sku gsku,goods g	   	
	where 
			main.id=shop.order_id
			and shop.id=osku.order_shop_id
			and main.id=osku.order_id
			and main.m_addr_id=md.id
			and main.m_id=m.id
			and gsku.id=osku.sku_id
			and gsku.goods_id=g.id
			
		<if test="shopId !='0'.toString()">
    		and shop.shop_id = #{shopId}
    	</if>
    	<if test="status != null and status !='' ">
    		<choose>
    			<when test="status==2">
    				and shop.status = #{status}
    				and shop.order_no    			
    				and NOT EXISTS (
	           			 SELECT 1
	         			FROM order_team ot
	             		WHERE ot. STATUS != 1 AND ot.order_no = shop.order_no
                  	)				
    			</when>
    			<otherwise>
    				and shop.status = #{status}
    			</otherwise>
    		</choose>
    		and osku.refund=0
	    </if>
	    <if test="orderNo != null and orderNo != '' ">
	    	and shop.order_no in
	    	 <foreach item="orderNoList" collection="orderNoList" open="(" close=")" separator=",">
	             #{orderNoList}
	         </foreach>
	    </if>
	    <if test="shopOrderNo != null and shopOrderNo != '' ">
	    	and shop.shop_order_no in
			 <foreach item="orderShopNoList" collection="orderShopNoList" open="(" close=")" separator=",">
	             #{orderShopNoList}
	         </foreach>
	    </if>
	    <if test="startTime != null" >
	       and  main.addtime <![CDATA[>=]]> #{startTime}
	    </if>
	    <if test="endTime != null" >
	       and  main.addtime <![CDATA[<=]]> #{endTime}
	    </if>
	    <if test="id != null">
	    	and m.id = #{id}
	    </if>
	    <if test="tel != null and tel !=''">
	    	and m.phone like CONCAT('%',#{tel}, '%')
	    </if>
	    <if test="fullName != null and fullName!=''">
	    	and m.username like CONCAT('%',#{fullName}, '%')
	    </if>
	    <if test="goodsName != null and goodsName!=''">
	    	and osku.goods_name like CONCAT('%',#{goodsName}, '%')
	    </if>
           order by main.addtime desc
  </select>
   <select id="getSimpleShareOrderList" resultMap="MyResultMap" parameterType="java.util.Map" > 
     	
     	select shop.id,shop.m_id,shop.order_no,shop.shop_order_no,shop.status,
   	        cast(shop.order_price/100 as decimal(20,2)) as all_price,
   	        shop.remark,shop.is_refund,
			main.addtime as addtime,main.fz as top,
			osku.goods_name as goods_name,
			osku.sku_image as goods_image,
			cast(osku.sku_sell_price_real/100 as decimal(20,2)) as price,
			osku.sku_num as good_num,
			osku.sku_value as value,
			md.full_name as full_name,
			md.tel as tel,
			md.provname as provname,
			md.cityname as cityname,
			md.areaname as areaname,
			md.fourname as fourname,
			md.address as address,
			m.username as user_nick,
			m.phone as phone,
			gsku.jd_sku_no as jd_sku_no,
			cast(gsku.jd_price/100 as decimal(20,2)) as jd_pirce ,
			cast(gsku.jd_protocol_price/100 as decimal(20,2)) as jd_protocol_price,
			g.team_num as team_num,
			osku.id as order_sku_id,shop.d_state as d_state
	 from 
			order_main main,order_shop shop,order_sku osku,member m,member_user_address md,
			goods_sku gsku,goods g,order_team team 	
	where 
			main.id=shop.order_id
			and shop.id=osku.order_shop_id
			and main.id=osku.order_id
			and main.m_addr_id=md.id
			and main.m_id=m.id
			and gsku.id=osku.sku_id
			and gsku.goods_id=g.id
			and shop.order_no=team.order_no
    	    and team.`status`=0
    	    and shop.`status`=2 
    <if test="shopId !='0'.toString()">
    	and shop.shop_id = #{shopId}
    </if>
    <if test="orderNo != null and orderNo != '' ">
    	and shop.order_no in 
    	 <foreach item="orderNoList" collection="orderNoList" open="(" close=")" separator=",">
             #{orderNoList}
         </foreach>
    </if>
    <if test="shopOrderNo != null and shopOrderNo != '' ">
    	and shop.shop_order_no in
		 <foreach item="orderShopNoList" collection="orderShopNoList" open="(" close=")" separator=",">
             #{orderShopNoList}
         </foreach>
    </if>
    <if test="startTime != null" >
       and  main.addtime <![CDATA[>=]]> #{startTime}
    </if>
    <if test="endTime != null" >
       and  main.addtime <![CDATA[<=]]> #{endTime}
    </if>
    <if test="id != null">
    	and m.id = #{id}
    </if>
    <if test="tel != null and tel !=''">
    	and m.phone like CONCAT('%', #{tel}, '%')
    </if>
    <if test="fullName != null and fullName!=''">
    	and m.username like CONCAT('%', #{fullName}, '%')
    </if>
    <if test="goodsName != null and goodsName!=''">
    	and osku.goods_name like CONCAT('%', #{goodsName}, '%')
    </if>
   order by main.addtime desc
  </select> 
  
  <select id="orderShopCount" resultType="java.lang.Integer">
  	   	select COUNT(*)
	    from 
			order_main main,order_shop shop,order_sku osku,member m,member_user_address md,
			goods_sku gsku,goods g	   	
	    where 
			main.id=shop.order_id
			and shop.id=osku.order_shop_id
			and main.id=osku.order_id
			and main.m_addr_id=md.id
			and main.m_id=m.id
			and gsku.id=osku.sku_id
			and gsku.goods_id=g.id
  <if test="shopId !='0'.toString()">
    		and shop.shop_id = #{shopId}
  </if>
  <if test="status !='0'.toString()">
    		<choose>
    			<when test="status==2">
    				and shop.status = #{status}
    				and shop.order_no and NOT EXISTS (
						SELECT 1
						FROM order_team ot
						WHERE ot. STATUS != 1 AND ot.order_no = shop.order_no
					)
    			</when>
    			<otherwise>
    				and shop.status = #{status}
    			</otherwise>
    		</choose>
    	and osku.refund=0	
  </if>
  </select>  
   <select id="selectShareCount" resultType="java.lang.Integer">
   		select count(shop.id)	
	 from 
			order_main main,order_shop shop,order_sku osku,member m,member_user_address md,
			goods_sku gsku,goods g,order_team team 	
	where 1=1
			and main.id=shop.order_id
			and shop.id=osku.order_shop_id
			and main.id=osku.order_id
			and main.m_addr_id=md.id
			and main.m_id=m.id
			and gsku.id=osku.sku_id
			and gsku.goods_id=g.id
			and shop.order_no=team.order_no
    	    and team.`status`=0
    	    and shop.`status`=2 
			<if test="shopId !='0'.toString()">
    		   and shop.shop_id = #{shopId}
            </if>
   </select>
   
   
    <select id="selectJDOrderList" resultMap="MyResultMap" parameterType="java.util.Map" >
   	select shop.id,shop.m_id,shop.order_no,shop.shop_order_no,shop.status,
   	        cast(shop.order_price/100 as decimal(20,2)) as all_price,
   	        shop.remark,shop.is_refund,
			main.addtime as addtime,main.fz as top,
			osku.goods_name as goods_name,
			osku.sku_image as goods_image,
			cast(osku.sku_sell_price_real/100 as decimal(20,2)) as price,
			osku.sku_num as good_num,
			osku.sku_value as value,
			md.full_name as full_name,
			md.tel as tel,
			md.provname as provname,
			md.cityname as cityname,
			md.areaname as areaname,
			md.fourname as fourname,
			md.address as address,
			m.username as user_nick,
			m.phone as phone,
			gsku.jd_sku_no as jd_sku_no,
			cast(gsku.jd_price/100 as decimal(20,2)) as jd_pirce ,
			cast(gsku.jd_protocol_price/100 as decimal(20,2)) as jd_protocol_price,
			g.team_num as team_num,osku.id as order_sku_id,
			shop.jdOrderId,shop.err_code,shop.err_msg		
	 from 
			order_main main,order_shop shop,order_sku osku,member m,member_user_address md,
			goods_sku gsku,goods g	   	
	where 
			main.id=shop.order_id
			and shop.id=osku.order_shop_id
			and main.id=osku.order_id
			and main.m_addr_id=md.id
			and main.m_id=m.id
			and gsku.id=osku.sku_id
			and gsku.goods_id=g.id
			and shop.jdOrderId !='0'
		<if test="shopId !='0'.toString()">
    		and shop.shop_id = #{shopId}
    	</if>
    	<if test="status != null and status !='' ">
    	 and shop.status = #{status}		
	    </if>
	    <if test="orderNo != null and orderNo != '' ">
	    	and shop.order_no in 
	    	 <foreach item="orderNoList" collection="orderNoList" open="(" close=")" separator=",">
	             #{orderNoList}
	         </foreach>
	    </if>
	    <if test="shopOrderNo != null and shopOrderNo != '' ">
	    	and shop.shop_order_no in  
			 <foreach item="orderShopNoList" collection="orderShopNoList" open="(" close=")" separator=",">
	             #{orderShopNoList}
	         </foreach>
	    </if>
	    <if test="startTime != null and startTime !='' " >
	       and  main.addtime <![CDATA[>=]]> #{startTime}
	    </if>
	    <if test="endTime != null and endTime !='' " >
	       and  main.addtime <![CDATA[<=]]> #{endTime}
	    </if>
	    <if test="id != null">
	    	and m.id = #{id}
	    </if>
	    <if test="tel != null and tel !=''">
	    	and m.phone like CONCAT('%', #{tel}, '%')
	    </if>
	    <if test="fullName != null and fullName!=''">
	    	and m.username like CONCAT('%', #{fullName}, '%')
	    </if>
	    <if test="goodsName != null and goodsName!=''">
	    	and osku.goods_name like CONCAT('%', #{goodsName}, '%')
	    </if>
           order by main.addtime desc
  </select>
   <select id="selectJdOrderListCount" resultType="java.lang.Integer">
  	   	select COUNT(shop.id)
	   	 from 
			order_main main,order_shop shop,order_sku osku,member m,member_user_address md,
			goods_sku gsku,goods g	   	
	where 
			main.id=shop.order_id
			and shop.id=osku.order_shop_id
			and main.id=osku.order_id
			and main.m_addr_id=md.id
			and main.m_id=m.id
			and gsku.id=osku.sku_id
			and gsku.goods_id=g.id
			and shop.jdOrderId !='0'
  <if test="shopId !='0'.toString()">
    		and shop.shop_id = #{shopId}
  </if>
  <if test="status != null and status !='0'.toString() and status!='' ">
    	 and shop.status = #{status}		
    	  </if>
  </select> 
  
  
   <!-- 查询除待付款和已取消,并且已删除是代付款的  所有其他订单  xieyc -->
  <select id="getAlreadyByShopIdByTimes" resultType="com.bh.admin.pojo.order.OrderShop" parameterType="com.bh.admin.pojo.order.OrderShop" >
    select a.id, cast((a.order_price-a.g_delivery_price)/100 as decimal(20,2))  realOrderPrice
    from order_shop a , order_main b
    where a.order_id = b.id
   	and a.status in(2,3,5,7,8,9)
   	and b.payment_status!=1
    <if test="startTime!=null">
    	<![CDATA[ and b.addtime >=]]>#{startTime}
    </if>
    <if test="endTime!=null">
    	 <![CDATA[ and b.addtime <=]]>#{endTime}
    </if>
    <if test="shopId!='0'.toString()">
    	and a.shop_id = #{shopId}
    </if>
  </select>
  
   <!-- 统计某个时段下的单 是否全部退款成功的订单条数 -->
  <select id="getAllRefund"  resultMap="BaseResultMap">
  	 select a.*  from  order_shop a ,order_main b 
   	 where b.id=a.order_id 
   	 and a.is_refund=2 
   	 <if test="startTime!=null">
	    <![CDATA[ and b.addtime >=]]>#{startTime}
	 </if>
	 <if test="endTime!=null">
	    <![CDATA[ and b.addtime <=]]>#{endTime}
	 </if>
     <if test="shopId !=null">
    	and a.shop_id = #{shopId}
     </if>
  </select>
  
  <select id="getAllRefund1"  resultMap="BaseResultMap">
  	 select a.*  from  order_shop a ,order_main b 
   	 where b.id=a.order_id 
   	 and a.is_refund=2 
     <if test="shopId !=null">
    	and a.shop_id = #{shopId}
     </if>
  </select>
  
  <!-- 统计某个时段下的订单条数 -->
  <select id="getAllOrderShopNum"  resultType="java.lang.Integer">
  	 select count(*)
   	 from  order_shop a ,order_main b 
   	 where b.id=a.order_id 
   	 and a.status not in(1,6,8) and b.payment_status!=1
   	 <if test="startTime!=null">
	    <![CDATA[ and b.addtime >=]]>#{startTime}
	 </if>
	 <if test="endTime!=null">
	    <![CDATA[ and b.addtime <=]]>#{endTime}
	 </if>
     <if test="shopId !=null">
    	and a.shop_id = #{shopId}
     </if>
  </select>
  
  <select id="getAllOrderShopNum1"  resultType="java.lang.Integer">
  	 select count(*)
   	 from  order_shop a ,order_main b 
   	 where b.id=a.order_id 
   	 and a.status not in(1,6,8) and b.payment_status!=1
     <if test="shopId !=null">
    	and a.shop_id = #{shopId}
     </if>
  </select>
  
  <select id="selectByOrderNo"  resultMap="BaseResultMap" parameterType="java.lang.String">
    select * from order_shop where shop_order_no=(SELECT os.shop_order_no FROM order_refund_doc ord ,order_shop os where ord.order_id=os.order_id and ord.id=#{id} and os.shop_id=#{shopId})
  </select>
  
  <select id="selectByOrderNos"  resultMap="BaseResultMap" parameterType="java.lang.String">
    select * from order_shop where order_no=#{orderNo} and shop_id=#{shopId}
  </select>
  
  <select id="selectByShopOrderNo"  resultMap="BaseResultMap" parameterType="java.lang.String">
    select * from order_shop where shop_order_no=#{shopOrderNo}
  </select>
  
  <select id="selectByTeamOrderNo"  resultMap="BaseResultMap" parameterType="java.lang.String">
    select os.* from order_team ot,order_shop os where ot.order_no=os.order_no AND ot.order_no=#{orderNo}
  </select>
  
 <!--  <select id="selectByGoodsIdTeam"  resultMap="BaseResultMap" parameterType="java.lang.String">
    select * from order_team ot,order_shop os where ot.order_no=os.order_no
     AND ot.status=1 AND ot.order_no =(select g.order_no from order_team g where g.goods_id=#{goodsId} AND g.status=1 group by g.team_no)
  </select> -->
  
  
  	
 	<select id="getCanWithdraList"  resultMap="BaseResultMap" parameterType="java.lang.Integer">
    	select a.* from order_shop a,order_main b 
		where a.order_id =b.id 
		and (a.status =5 or a.status =7 or a.status =8)
		and b.payment_status!=1 
	    and date_sub(a.receivedtime,interval -8 day)<![CDATA[<=]]>NOW()
		and a.shop_id = #{shopId}
    </select>
    
    
    <select id="getSettleList"  resultMap="BaseResultMap" parameterType="com.bh.admin.pojo.order.OrderShop">
    	select a.* from order_shop a,order_main b 
		where a.order_id =b.id 
		and (a.status =2 or a.status =3 or a.status =9)
		<if test="shopId != null">
			and a.shop_id = #{shopId}
		</if>
		<if test="startDateTime != null and startDateTime!='' ">
			and  b.addtime <![CDATA[>=]]> #{startDateTime}
		</if>
		<if test="endDateTime != null and endDateTime!='' ">
			and  b.addtime <![CDATA[<]]> date_sub(#{endDateTime},interval -1 day)
		</if>
    </select>
    
      <select id="getTrandeList"  resultMap="BaseResultMap" parameterType="com.bh.admin.pojo.order.OrderShop">
    	select a.* from order_shop a,order_main b 
		where a.order_id =b.id 
		and a.status in (2,3,5,7,8,9)
		and b.payment_status!=1 
		<if test="shopId != null">
			and a.shop_id = #{shopId}
		</if>
		<if test="startDateTime != null and startDateTime!='' ">
			and  b.addtime <![CDATA[>=]]> #{startDateTime}
		</if>
		<if test="endDateTime != null and endDateTime!='' ">
			and  b.addtime <![CDATA[<]]> date_sub(#{endDateTime},interval -1 day)
		</if>
     </select>
     
      <select id="getTrandeList1"  resultMap="BaseResultMap" parameterType="com.bh.admin.pojo.order.OrderShop">
    	select a.* from order_shop a,order_main b 
		where a.order_id =b.id 
		and a.status in (2,3,5,7,8,9)
		and b.payment_status!=1 
		and a.shop_id = #{shopId}
     </select>
    
    
   
    
    
    
    
    
    
  
</mapper>